"use strict";var e=require("tslib"),t={strokeWidth:.5},i=function(){function i(i,n){Object.defineProperty(this,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_penData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_totalTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_curTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_rate",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_isplaying",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_leftPenData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_myRequestAnimationFrame",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._canvas=i,this._config=e.__assign(e.__assign({},t),n),this._penData=Array.from(null==n?void 0:n.penDatas);var a=this._canvas.getContext("2d");a.imageSmoothingEnabled=!0,a.lineJoin="round",a.lineCap="round",a.lineWidth=this._config.strokeWidth}return Object.defineProperty(i.prototype,"_parseToLines",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=[];return e.forEach((function(e){var i={x:e.x,y:e.y};"PEN_DOWN"===e.type?t.push({points:[i]}):"PEN_MOVE"!==e.type&&"PEN_UP"!==e.type||t[t.length-1].points.push(i)})),t}}),Object.defineProperty(i.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._canvas.getContext("2d"),t=this._parseToLines(this._penData);0!==t.length&&(e.beginPath(),t.forEach((function(t){var i=t.points,n=i[0],a=i.slice(1);e.moveTo(n.x,n.y),null==a||a.forEach((function(t){e.lineTo(t.x,t.y)}))})),e.stroke())}}),Object.defineProperty(i.prototype,"play",{enumerable:!1,configurable:!0,writable:!0,value:function(){0===this._curTime&&this._clearCanvas(),this._isplaying=!0,this._leftPenData||(this._leftPenData=Array.from(this._penData));var e,t,i,n=this._canvas.getContext("2d"),a=this._penData[0].timelong;this._myRequestAnimationFrame=window.requestAnimationFrame(function r(o){var l=this;if(void 0===t&&(t=o),this._curTime+=this._rate*((i=o)-t),this._curTime>0){var s=this._leftPenData.filter((function(e){return e.timelong-a<=l._curTime}));this._leftPenData.splice(0,s.length),s.length>0&&(n.beginPath(),["PEN_DOWN","PEN_MOVE"].includes(null==e?void 0:e.type)&&n.moveTo(e.x,e.y),s.forEach((function(t,i){"PEN_DOWN"===t.type?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y),i===s.length-1&&(e=t)})),n.stroke())}this._leftPenData.length>0?this._myRequestAnimationFrame=window.requestAnimationFrame(r.bind(this)):this._isplaying=!1,t=i}.bind(this))}}),Object.defineProperty(i.prototype,"totalTime",{get:function(){var e,t,i,n,a=null!==(t=null===(e=this._penData[0])||void 0===e?void 0:e.timelong)&&void 0!==t?t:0;return(null!==(n=null===(i=this._penData[this._penData.length-1])||void 0===i?void 0:i.timelong)&&void 0!==n?n:0)-a},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._curTime},set:function(e){this._curTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rate",{get:function(){return this._rate},set:function(e){this._rate=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pause",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._myRequestAnimationFrame&&window.cancelAnimationFrame(this._myRequestAnimationFrame),this._isplaying=!1}}),Object.defineProperty(i.prototype,"appendPenData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(null==e?void 0:e.length)>0&&(Array.prototype.push.apply(this._penData,e),Array.prototype.push.apply(this._leftPenData,e),this._isplaying||this.play())}}),Object.defineProperty(i.prototype,"_clearCanvas",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t;(null===(e=this._canvas)||void 0===e?void 0:e.parentNode)&&(null===(t=this._canvas.getContext("2d"))||void 0===t||t.clearRect(0,0,this._canvas.width,this._canvas.height),this._leftPenData=null)}}),Object.defineProperty(i.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t;this._myRequestAnimationFrame&&window.cancelAnimationFrame(this._myRequestAnimationFrame),(null===(e=this._canvas)||void 0===e?void 0:e.parentNode)&&(null===(t=this._canvas.getContext("2d"))||void 0===t||t.clearRect(0,0,this._canvas.width,this._canvas.height)),this._canvas=null}}),i}();module.exports=i;
